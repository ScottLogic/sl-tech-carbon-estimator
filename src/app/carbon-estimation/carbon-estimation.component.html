<div class="tce:flex tce:flex-col" aria-live="polite">
  <expansion-panel
    #detailsPanel
    (expandedChanged)="onExpanded()"
    class="tce:flex tce:justify-between tce:gap-2 tce:flex-col">
    <div header>
      <h2 class="tce:text-2xl">Estimations</h2>
    </div>
    <div content>
      <p>
        The estimations are divided into 4 categories:
        <a class="tce:underline" href="https://www.techcarbonstandard.org/categories/upstream" tce-external-link
          >Upstream Emissions</a
        >,
        <a
          class="tce:underline"
          href="https://www.techcarbonstandard.org/categories/operational#direct-emissions"
          tce-external-link
          >Operational Direct Emissions</a
        >,
        <a
          class="tce:underline"
          href="https://www.techcarbonstandard.org/categories/operational#indirect-emissions"
          tce-external-link
          >Operational Indirect Emissions</a
        >, and
        <a class="tce:underline" href="https://www.techcarbonstandard.org/categories/downstream" tce-external-link
          >Downstream Emissions</a
        >.
      </p>
    </div>
  </expansion-panel>
  
  <tabs class="tce:mt-2">
    <tab-item [active]="true" [title]="'Diagram'" (tabSelected)="treemapSelected()">
      <carbon-estimation-treemap
        #treemap
        [carbonEstimation]="carbonEstimation()"
        [chartHeight]="chartHeight"
        [shouldShowUnitsSwitch]="true"></carbon-estimation-treemap>
    </tab-item>
    <tab-item [title]="'Table'">
      <carbon-estimation-table [carbonEstimation]="carbonEstimation()" [shouldShowSvgs]="true"></carbon-estimation-table
    ></tab-item>
    <tab-item [title]="'Export'">
      <div class="tce-relative tce-inline-block">
    <button class="tce-bg-slate-200 tce-px-4 tce-py-2 tce-rounded tce-shadow tce-font-medium" (click)="toggleExportMenu()"
      >
      Export â–¼
    </button>
    <div *ngIf="isExportMenuOpen"
      class="tce-absolute tce-right-0 tce-mt-2 tce-bg-white tce-shadow-lg tce-rounded tce-z-10 tce-min-w-[200px]"
      (click)="$event.stopPropagation()">
      <a [href]="carbonEstimationDownloadUrl" download="carbon-estimation.json"
        class="tce-block tce-px-4 tce-py-2 tce-text-slate-800 tce-hover:bg-slate-100 tce-underline" tce-external-link>
        Export JSON
      </a>
      <a [href]="carbonEstimationWithInputDownloadUrl" download="carbon-estimation-with-inputs.json"
        class="tce-block tce-px-4 tce-py-2 tce-text-slate-800 tce-hover:bg-slate-100 tce-underline" tce-external-link>
        Export JSON with Inputs
      </a>
      <button class="tce-block tce-w-full tce-px-4 tce-py-2 tce-text-slate-800 tce-hover:bg-slate-100 tce-text-left"
        (click)="showModal()">
        Export PDF
      </button>
    </div>
  </div>
    </tab-item>
  </tabs>
  <export-modal
    *ngIf="isModalVisible"
    (close)="hideModal()"
    [carbonEstimation]="carbonEstimation()"
    [inputValues]="inputValues()"
  ></export-modal>
</div>